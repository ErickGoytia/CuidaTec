<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Reportar Fuga ‚Äî CuidaTec</title>
  <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>
<header class="container header">
  <div class="brand">
    <div class="logo">üíß</div>
    <a href="index.html" class="brand-name">CuidaTec</a>
  </div>
  <nav class="nav">
    <a href="index.html">Inicio</a>
    <a href="reportar.html">Reportar</a>
    <a href="calculadora.html">Calculadora</a>
    <a href="consejos.html">Consejos</a>
    <a href="contacto.html">Contacto</a>
  </nav>
  <div class="header-blob"></div>
</header>

<main class="container">
  <h1>Reportar fuga</h1>
  <p class="muted">Cu√©ntanos d√≥nde est√° la fuga. Solo ‚Äúcalle‚Äù y ‚Äúdescripci√≥n‚Äù son obligatorios.</p>

  <div class="card">
    <div class="form" style="display:grid;gap:12px">
      <input id="nombre" placeholder="Tu nombre (opcional)">
      <input id="contacto" placeholder="Contacto (opcional)">
      <input id="calle" placeholder="Ubicaci√≥n (calle) *">
      <input id="colonia" placeholder="Colonia">
      <input id="codigopostal" placeholder="C√≥digo postal">
      <textarea id="referencias" placeholder="Referencias"></textarea>
      <textarea id="descripcion" placeholder="Descripci√≥n *"></textarea>

      <label>Categor√≠a
        <select id="categoria">
          <option value="1">Fuga en red p√∫blica</option>
          <option value="2">Fuga en toma domiciliaria</option>
        </select>
      </label>

      <label>Severidad
        <select id="severidad">
          <option value="1">Baja</option>
          <option value="2">Media</option>
          <option value="3">Alta</option>
        </select>
      </label>

      <button id="btnEnviar" class="btn primary">Enviar</button>
      <p id="msg" class="muted"></p>
    </div>
  </div>
</main>

<script src="assets/js/main.js"></script>
<script>
const API = window.API_BASE;
const $ = id => document.getElementById(id);

document.getElementById("btnEnviar").onclick = async () => {
  $("msg").textContent = "";

  const calle = $("calle").value.trim();
  const descripcion = $("descripcion").value.trim();

  if (!calle || !descripcion) {
    $("msg").textContent = "Los campos obligatorios no pueden estar vac√≠os.";
    return;
  }

  const payload = {
    calle,
    colonia: $("colonia").value.trim() || null,
    codigo_postal: $("codigopostal").value.trim() || null,
    referencias: $("referencias").value.trim() || null,
    titulo: descripcion.slice(0, 30),
    descripcion,
    categoria_id: Number($("categoria").value),
    severidad_id: Number($("severidad").value),
    reportante_nombre: $("nombre").value.trim() || null,
    reportante_contacto: $("contacto").value.trim() || null
  };

  try {
    const res = await fetch(API + "/api/reports", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!res.ok) {
      $("msg").textContent = "Error al enviar.";
      return;
    }

    $("msg").textContent = "Reporte enviado correctamente.";
  } catch (err) {
    console.error(err);
    $("msg").textContent = "No se pudo conectar con la API.";
  }
};
</script>
</body>
</html>
